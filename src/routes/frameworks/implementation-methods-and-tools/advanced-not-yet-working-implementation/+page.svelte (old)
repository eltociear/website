<!-- src/routes/frameworks/implementation-methods-and-tools/+page.svelte -->
<script>
  import { onMount } from 'svelte';
  import { page } from '$app/stores';
  import { t, translations } from '$lib/i18n';
  import { base } from '$app/paths';
  import ContextAssessmentRubric from '$lib/components/ContextAssessmentRubric.svelte';
  import ToolDatabase from '$lib/components/ToolDatabase.svelte';
  import JourneySelector from '$lib/components/JourneySelector.svelte';
  import ToolStackVisualizer from '$lib/components/ToolStackVisualizer.svelte';
  import ToolDetailModal from '$lib/components/ToolDetailModal.svelte';
  
  // Get page data including loaded markdown content
  export let data;
  
  // Extract content and metadata from data
  $: ({ content, tools, toolStacks, debug } = data);
  
  // Get translation namespaces - with fallbacks to prevent empty text
  $: implementationT = $translations?.implementationTools || {};
  $: assessmentT = $translations?.assessment || {};
  $: journeysT = $translations?.journeys || {};
  $: toolDatabaseT = $translations?.toolDatabase || {};
  $: stackVisualizerT = $translations?.stackVisualizer || {};
  $: commonT = $translations?.common || {};
  
  // Helper function for implementation tools translations
  function implT(key, fallback = '') {
    if (!implementationT || typeof implementationT !== 'object') {
      console.warn('implementationT not available:', implementationT);
      return fallback;
    }
    
    const keys = key.split('.');
    let result = implementationT;
    
    for (const k of keys) {
      if (result && typeof result === 'object' && k in result) {
        result = result[k];
      } else {
        console.warn(`Translation key not found: implementationTools.${key}`, 'Available keys:', Object.keys(implementationT));
        return fallback;
      }
    }
    
    return result || fallback;
  }
  
  // Helper for common translations
  function commonT_helper(key, fallback = '') {
    if (!commonT || typeof commonT !== 'object') {
      return fallback;
    }
    
    const keys = key.split('.');
    let result = commonT;
    
    for (const k of keys) {
      if (result && typeof result === 'object' && k in result) {
        result = result[k];
      } else {
        return fallback;
      }
    }
    
    return result || fallback;
  }
  
  // Debug logging
  $: {
    console.log('=== CONTENT DEBUG ===');
    console.log('Available content:', Object.keys(content || {}));
    console.log('Debug info:', debug);
    console.log('Tools count:', Object.keys(tools || {}).length);
    console.log('Tool stacks count:', Object.keys(toolStacks || {}).length);
    console.log('=========================');
  }
  
  // Page state
  let currentSection = 'overview';
  let isAssessmentComplete = false;
  let recommendedStack = null;
  let selectedJourney = null;
  let searchQuery = '';
  let selectedFilters = {};
  
  // Tool detail modal state
  let selectedTool = null;
  let isToolModalOpen = false;
  
  // Assessment results
  let assessmentResults = {
    governanceMaturity: null,
    conflictIntensity: null,
    resourceAvailability: null,
    culturalCoherence: null
  };

  // Navigation sections
  const sections = [
    { id: 'overview', name: 'Overview', icon: 'üè†' },
    { id: 'assessment', name: 'Context Assessment', icon: 'üìä' },
    { id: 'journeys', name: 'Journey Selection', icon: 'üó∫Ô∏è' },
    { id: 'tools', name: 'Tool Database', icon: 'üîß' },
    { id: 'stacks', name: 'Tool Stacks', icon: 'üì¶' },
    { id: 'guidance', name: 'Implementation Guidance', icon: 'üí°' },
    { id: 'appendices', name: 'Appendices', icon: 'üìö' }
  ];

  onMount(() => {
    // Check for existing assessment results
    const saved = localStorage.getItem('implementationAssessment');
    if (saved) {
      assessmentResults = JSON.parse(saved);
      isAssessmentComplete = true;
      recommendedStack = calculateRecommendedStack(assessmentResults);
    }

    // Check URL hash for section navigation
    if (typeof window !== 'undefined' && window.location.hash) {
      const hash = window.location.hash.slice(1);
      if (sections.find(s => s.id === hash)) {
        currentSection = hash;
      }
    }
  });

  function calculateRecommendedStack(results) {
    // Simple recommendation logic (would be more sophisticated in reality)
    if (results.conflictIntensity === 'high') {
      return toolStacks['crisis-response'];
    } else if (results.governanceMaturity === 'low') {
      return toolStacks['getting-started'];
    } else {
      return toolStacks['building-capacity'];
    }
  }

  function handleAssessmentComplete(event) {
    assessmentResults = event.detail;
    isAssessmentComplete = true;
    recommendedStack = calculateRecommendedStack(assessmentResults);
    
    // Save to localStorage
    localStorage.setItem('implementationAssessment', JSON.stringify(assessmentResults));
    
    // Navigate to results
    currentSection = 'stacks';
  }

  function resetAssessment() {
    assessmentResults = {
      governanceMaturity: null,
      conflictIntensity: null,
      resourceAvailability: null,
      culturalCoherence: null
    };
    isAssessmentComplete = false;
    recommendedStack = null;
    localStorage.removeItem('implementationAssessment');
    currentSection = 'assessment';
  }

  function selectSection(sectionId) {
    currentSection = sectionId;
    // Update URL hash without page reload
    if (typeof window !== 'undefined') {
      window.history.replaceState(null, null, `#${sectionId}`);
    }
  }

  function selectJourney(journey) {
    selectedJourney = journey;
    currentSection = 'tools';
  }

  function openToolDetail(tool) {
    selectedTool = tool;
    isToolModalOpen = true;
  }

  function closeToolDetail() {
    selectedTool = null;
    isToolModalOpen = false;
  }

  // Helper function to render markdown content
  function renderMarkdownSection(sectionContent) {
    if (!sectionContent || !sectionContent.default) {
      return '<p>Content not available</p>';
    }
    
    try {
      const component = sectionContent.default;
      if (typeof component === 'function') {
        const result = component();
        if (result && result.render) {
          return result.render().html;
        }
      }
      return '<p>Unable to render content</p>';
    } catch (error) {
      console.error('Error rendering markdown:', error);
      return '<p>Error loading content</p>';
    }
  }
</script>

<svelte:head>
  <title>{$t('framework.docs.nav.frameworkTitles.implementationMethodsAndTools', 'Implementation Methods & Tools Framework')}</title>
  <meta name="description" content="{$t('framework.implementationTools.meta.description', 'The GGF\'s comprehensive toolkit for implementing governance frameworks')}" />
</svelte:head>

<div class="implementation-tools-page">
  <!-- Header Section -->
  <section class="page-header">
    <div class="container">
      <div class="header-content">
        <div class="header-text">
          <h1 class="page-title">
            üß∞ {$t('framework.docs.nav.frameworkTitles.implementationMethodsAndTools', 'Implementation Methods & Tools Framework')}
          </h1>
          <p class="page-subtitle">
            {$t('framework.implementationTools.subtitle', 'Your comprehensive toolkit for bringing governance frameworks to life')}
          </p>
          <div class="framework-meta">
            <span class="tier-badge tier-4">
              {$t('framework.tier.4.title', 'Tier 4: Meta-Framework')}
            </span>
            <span class="status-badge status-review">
              {$t('framework.status.review', 'Under Review')}
            </span>
          </div>
        </div>
        <div class="header-visual">
          <div class="toolkit-icon">üß∞</div>
          <div class="connection-lines">
            <div class="line line-1"></div>
            <div class="line line-2"></div>
            <div class="line line-3"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Navigation Tabs -->
  <nav class="section-nav">
    <div class="container">
      <div class="nav-tabs">
        {#each sections as section}
          <button 
            class="nav-tab"
            class:active={currentSection === section.id}
            on:click={() => selectSection(section.id)}
          >
            <span class="tab-icon">{section.icon}</span>
            <span class="tab-text">{section.name}</span>
          </button>
        {/each}
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      
      {#if currentSection === 'overview'}
        <section class="content-section overview-section">
          <div class="section-grid">
            <div class="section-content">
              
              <!-- Render markdown content for overview -->
              {#if content?.sections?.overview}
                <div class="markdown-content">
                  {@html renderMarkdownSection(content.sections.overview)}
                </div>
              {:else}
                <!-- Fallback content if markdown not loaded -->
                <h2>{implT('overview.title', 'The GGF\'s Operating Manual')}</h2>
                
                <div class="intro-text">
                  <p>{implT('overview.intro', 'Visionary frameworks fail without practical, adaptable tools. This meta-framework provides standardized playbooks, modular tools, and culturally adaptable methodologies for implementing all other GGF frameworks.')}</p>
                </div>

                <div class="key-features">
                  <h3>{implT('overview.keyFeatures', 'Key Features')}</h3>
                  <div class="feature-grid">
                    <div class="feature-card">
                      <div class="feature-icon">üìä</div>
                      <h4>{implT('features.assessment.title', 'Context Assessment')}</h4>
                      <p>{implT('features.assessment.description', 'Interactive rubric to evaluate your governance maturity, resources, and cultural context')}</p>
                    </div>
                    
                    <div class="feature-card">
                      <div class="feature-icon">üó∫Ô∏è</div>
                      <h4>{implT('features.journeys.title', 'Journey-Based Tools')}</h4>
                      <p>{implT('features.journeys.description', 'Curated toolkits for different stages: Getting Started, Crisis Response, Building Capacity')}</p>
                    </div>
                    
                    <div class="feature-card">
                      <div class="feature-icon">üåç</div>
                      <h4>{implT('features.cultural.title', 'Cultural Adaptation')}</h4>
                      <p>{implT('features.cultural.description', 'Anti-colonial design with Indigenous co-creation protocols and cultural translation tools')}</p>
                    </div>
                    
                    <div class="feature-card">
                      <div class="feature-icon">üîß</div>
                      <h4>{implT('features.modular.title', 'Modular Design')}</h4>
                      <p>{implT('features.modular.description', 'Mix and match tools like Lego blocks to create customized implementation stacks')}</p>
                    </div>
                  </div>
                </div>

                <div class="quick-start">
                  <h3>{implT('quickStart.title', 'Quick Start Guide')}</h3>
                  <div class="step-flow">
                    <div class="step-item">
                      <div class="step-number">1</div>
                      <div class="step-content">
                        <h4>{implT('quickStart.step1.title', 'Assess Context')}</h4>
                        <p>{implT('quickStart.step1.description', 'Complete the Context Assessment Rubric')}</p>
                        <button class="step-action" on:click={() => selectSection('assessment')}>
                          {commonT_helper('ui.startAssessment', 'Start Assessment')} ‚Üí
                        </button>
                      </div>
                    </div>
                    
                    <div class="step-arrow">‚Üí</div>
                    
                    <div class="step-item">
                      <div class="step-number">2</div>
                      <div class="step-content">
                        <h4>{implT('quickStart.step2.title', 'Choose Journey')}</h4>
                        <p>{implT('quickStart.step2.description', 'Select your implementation pathway')}</p>
                        <button class="step-action" on:click={() => selectSection('journeys')}>
                          {commonT_helper('ui.exploreJourneys', 'Explore Journeys')} ‚Üí
                        </button>
                      </div>
                    </div>
                    
                    <div class="step-arrow">‚Üí</div>
                    
                    <div class="step-item">
                      <div class="step-number">3</div>
                      <div class="step-content">
                        <h4>{implT('quickStart.step3.title', 'Pilot Tools')}</h4>
                        <p>{implT('quickStart.step3.description', 'Test tools and gather feedback')}</p>
                        <button class="step-action" on:click={() => selectSection('tools')}>
                          {commonT_helper('ui.browseTools', 'Browse Tools')} ‚Üí
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              {/if}
            </div>
            
            <div class="section-sidebar">
              <div class="info-card">
                <h4>{implT('info.currentStatus', 'Current Status')}</h4>
                <p>{implT('info.statusDescription', 'This framework is under active development. Core tools are being field-tested by early adopter communities.')}</p>
              </div>
              
              <div class="info-card">
                <h4>{implT('info.getInvolved', 'Get Involved')}</h4>
                <p>{implT('info.involvementDescription', 'Join our pilot testing program or contribute tool adaptations for your cultural context.')}</p>
                <a href="{base}/get-involved" class="info-link">
                  {commonT_helper('ui.learnMore', 'Learn More')} ‚Üí
                </a>
              </div>
            </div>
          </div>
        </section>
      {/if}

      {#if currentSection === 'assessment'}
        <!-- Context Assessment Section -->
        <section class="content-section assessment-section">
          <div class="section-header">
            <h2>{$t('framework.implementationTools.assessment.title', 'Context Assessment Rubric')}</h2>
            <p>{$t('framework.implementationTools.assessment.description', 'Evaluate your context to receive personalized tool recommendations')}</p>
          </div>

          <!-- Display assessment rubric markdown content if available -->
          {#if content?.sections?.[`assessment-rubric`]}
            <div class="markdown-content">
              {@html renderMarkdownSection(content.sections['assessment-rubric'])}
            </div>
          {/if}

          {#if isAssessmentComplete}
            <div class="assessment-results">
              <div class="results-header">
                <h3>{$t('framework.implementationTools.assessment.results.title', 'Assessment Complete')}</h3>
                <button class="reset-button" on:click={resetAssessment}>
                  {$t('common.ui.retakeAssessment', 'Retake Assessment')}
                </button>
              </div>
              
              <div class="results-grid">
                <div class="result-item">
                  <h4>{$t('framework.implementationTools.assessment.categories.governanceMaturity', 'Governance Maturity')}</h4>
                  <div class="result-value">{assessmentResults.governanceMaturity}</div>
                </div>
                <div class="result-item">
                  <h4>{$t('framework.implementationTools.assessment.categories.conflictIntensity', 'Conflict Intensity')}</h4>
                  <div class="result-value">{assessmentResults.conflictIntensity}</div>
                </div>
                <div class="result-item">
                  <h4>{$t('framework.implementationTools.assessment.categories.resourceAvailability', 'Resource Availability')}</h4>
                  <div class="result-value">{assessmentResults.resourceAvailability}</div>
                </div>
                <div class="result-item">
                  <h4>{$t('framework.implementationTools.assessment.categories.culturalCoherence', 'Cultural Coherence')}</h4>
                  <div class="result-value">{assessmentResults.culturalCoherence}</div>
                </div>
              </div>

              {#if recommendedStack}
                <div class="recommendation">
                  <h4>{$t('framework.implementationTools.assessment.recommendation.title', 'Recommended Tool Stack')}</h4>
                  <div class="recommended-stack">
                    <div class="stack-header">
                      <h5>{recommendedStack.name}</h5>
                      <span class="complexity-badge">{recommendedStack.complexity}</span>
                    </div>
                    <p>{recommendedStack.description}</p>
                    <div class="stack-meta">
                      <span class="meta-item">‚è±Ô∏è {recommendedStack.timeframe}</span>
                      <span class="meta-item">üí∞ {recommendedStack.resources}</span>
                    </div>
                    <button class="view-stack-button" on:click={() => selectSection('stacks')}>
                      {$t('common.ui.viewToolStack', 'View Tool Stack')} ‚Üí
                    </button>
                  </div>
                </div>
              {/if}
            </div>
          {:else}
            <ContextAssessmentRubric on:complete={handleAssessmentComplete} />
          {/if}
        </section>
      {/if}

      {#if currentSection === 'journeys'}
        <!-- Journey Selection Section -->
        <section class="content-section journeys-section">
          <div class="section-header">
            <h2>{$t('framework.implementationTools.journeys.title', 'Implementation Journeys')}</h2>
            <p>{$t('framework.implementationTools.journeys.description', 'Choose your path based on your situation and goals')}</p>
          </div>

          <!-- Display journey pathways markdown content if available -->
          {#if content?.sections?.['journey-pathways']}
            <div class="markdown-content">
              {@html renderMarkdownSection(content.sections['journey-pathways'])}
            </div>
          {/if}

          <JourneySelector 
            on:journeySelected={(e) => selectJourney(e.detail)}
            {recommendedStack}
          />
        </section>
      {/if}

      {#if currentSection === 'tools'}
        <!-- Tool Database Section -->
        <section class="content-section tools-section">
          <div class="section-header">
            <h2>{$t('framework.implementationTools.tools.title', 'Tool Database')}</h2>
            <p>{$t('framework.implementationTools.tools.description', 'Explore our comprehensive library of implementation tools')}</p>
          </div>

          <!-- Display tool database markdown content if available -->
          {#if content?.sections?.['tool-database']}
            <div class="markdown-content">
              {@html renderMarkdownSection(content.sections['tool-database'])}
            </div>
          {/if}

          <ToolDatabase 
            {tools}
            {selectedJourney}
            bind:searchQuery
            bind:selectedFilters
            on:toolSelected={(e) => openToolDetail(e.detail)}
          />
        </section>
      {/if}

      {#if currentSection === 'stacks'}
        <!-- Tool Stacks Section -->
        <section class="content-section stacks-section">
          <div class="section-header">
            <h2>{$t('framework.implementationTools.stacks.title', 'Tool Stacks')}</h2>
            <p>{$t('framework.implementationTools.stacks.description', 'Pre-configured tool combinations for common scenarios')}</p>
          </div>

          <ToolStackVisualizer 
            {toolStacks}
            {tools}
            {recommendedStack}
            on:toolSelected={(e) => openToolDetail(e.detail)}
          />
        </section>
      {/if}

      {#if currentSection === 'guidance'}
        <section class="content-section guidance-section">
          <div class="section-header">
            <h2>{implT('guidance.title', 'Implementation Guidance')}</h2>
            <p>{implT('guidance.description', 'Best practices and lessons learned from global implementations')}</p>
          </div>

          <!-- Display implementation guidance markdown content if available -->
          {#if content?.sections?.['implementation-guidance']}
            <div class="markdown-content">
              {@html renderMarkdownSection(content.sections['implementation-guidance'])}
            </div>
          {:else}
            <!-- Fallback content -->
            <div class="guidance-content">
              <div class="guidance-grid">
                <div class="guidance-card">
                  <h3>{implT('guidance.principles.title', 'Guiding Principles')}</h3>
                  <ul>
                    <li>{implT('guidance.principles.polycentric', 'Polycentric & Subsidiarity-First')}</li>
                    <li>{implT('guidance.principles.anticolonial', 'Anti-Colonial by Design')}</li>
                    <li>{implT('guidance.principles.lowtech', 'Low-Tech First & High-Tech Enabled')}</li>
                    <li>{implT('guidance.principles.modular', 'Modular & Interoperable')}</li>
                    <li>{implT('guidance.principles.humanloop', 'Human-in-the-Loop')}</li>
                  </ul>
                </div>

                <div class="guidance-card">
                  <h3>{implT('guidance.phases.title', 'Implementation Phases')}</h3>
                  <div class="phase-list">
                    <div class="phase-item">
                      <h4>{implT('guidance.phases.foundation', 'Phase 1: Foundation (Years 1-3)')}</h4>
                      <p>{implT('guidance.phases.foundationDesc', 'Council convening, BAZ formation, crisis response capabilities')}</p>
                    </div>
                    <div class="phase-item">
                      <h4>{implT('guidance.phases.integration', 'Phase 2: Integration (Years 4-7)')}</h4>
                      <p>{implT('guidance.phases.integrationDesc', 'Economic modeling, participatory processes, system coordination')}</p>
                    </div>
                    <div class="phase-item">
                      <h4>{implT('guidance.phases.evolution', 'Phase 3: Evolution (Years 8-15)')}</h4>
                      <p>{implT('guidance.phases.evolutionDesc', 'Consciousness development, AI symbiosis, graceful transitions')}</p>
                    </div>
                  </div>
                </div>

                <div class="guidance-card">
                  <h3>{implT('guidance.support.title', 'Support Infrastructure')}</h3>
                  <ul>
                    <li>{implT('guidance.support.facilitators', 'Certified Tool Facilitators')}</li>
                    <li>{implT('guidance.support.networks', 'Peer Learning Networks')}</li>
                    <li>{implT('guidance.support.technical', 'Technical Support Protocols')}</li>
                    <li>{implT('guidance.support.mediation', 'Conflict Mediation Services')}</li>
                  </ul>
                </div>

                <div class="guidance-card">
                  <h3>{implT('guidance.monitoring.title', 'Monitoring & Learning')}</h3>
                  <ul>
                    <li>{implT('guidance.monitoring.reflexive', 'Reflexive Cycle Protocol')}</li>
                    <li>{implT('guidance.monitoring.effectiveness', 'Tool Effectiveness Ratings')}</li>
                    <li>{implT('guidance.monitoring.failure', 'GGF Failure Library')}</li>
                    <li>{implT('guidance.monitoring.adaptation', 'Real-Time Adaptation Protocols')}</li>
                  </ul>
                </div>
              </div>
            </div>
          {/if}
        </section>
      {/if}

      {#if currentSection === 'appendices'}
        <section class="content-section appendices-section">
          <div class="section-header">
            <h2>üìö Appendices</h2>
            <p>Supporting documentation, templates, and reference materials</p>
          </div>

          <div class="appendices-grid">
            <!-- Anti-Colonial Evaluation Template -->
            {#if content?.appendices?.['anti-colonial-evaluation-template']}
              <div class="appendix-card">
                <h3>üåç Anti-Colonial Evaluation Template</h3>
                <div class="markdown-content">
                  {@html renderMarkdownSection(content.appendices['anti-colonial-evaluation-template'])}
                </div>
              </div>
            {/if}

            <!-- Glossary -->
            {#if content?.appendices?.glossary}
              <div class="appendix-card">
                <h3>üìñ Glossary</h3>
                <div class="markdown-content">
                  {@html renderMarkdownSection(content.appendices.glossary)}
                </div>
              </div>
            {/if}

            <!-- Resource Calculator -->
            {#if content?.appendices?.['resource-calculator']}
              <div class="appendix-card">
                <h3>üßÆ Resource Calculator</h3>
                <div class="markdown-content">
                  {@html renderMarkdownSection(content.appendices['resource-calculator'])}
                </div>
              </div>
            {/if}

            <!-- Success Patterns -->
            {#if content?.appendices?.['success-patterns']}
              <div class="appendix-card">
                <h3>‚ú® Success Patterns</h3>
                <div class="markdown-content">
                  {@html renderMarkdownSection(content.appendices['success-patterns'])}
                </div>
              </div>
            {/if}

            <!-- Failure Library Examples -->
            {#if content?.appendices?.['failure-library-examples']}
              <div class="appendix-card">
                <h3>üìã Failure Library Examples</h3>
                <div class="markdown-content">
                  {@html renderMarkdownSection(content.appendices['failure-library-examples'])}
                </div>
              </div>
            {/if}
          </div>

          <!-- Integration Documents -->
          {#if content?.integrations && Object.keys(content.integrations).length > 0}
            <div class="integration-section">
              <h3>üîó Framework Integrations</h3>
              <div class="integration-grid">
                {#each Object.keys(content.integrations) as integrationKey}
                  <div class="integration-card">
                    <h4>{integrationKey.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h4>
                    <div class="markdown-content">
                      {@html renderMarkdownSection(content.integrations[integrationKey])}
                    </div>
                  </div>
                {/each}
              </div>
            </div>
          {/if}

          <!-- Quickstart Guides -->
          {#if content?.quickstart && Object.keys(content.quickstart).length > 0}
            <div class="quickstart-section">
              <h3>üöÄ Quick Start Guides</h3>
              <div class="quickstart-grid">
                {#each Object.keys(content.quickstart) as guideKey}
                  <div class="quickstart-card">
                    <h4>{guideKey.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h4>
                    <div class="markdown-content">
                      {@html renderMarkdownSection(content.quickstart[guideKey])}
                    </div>
                  </div>
                {/each}
              </div>
            </div>
          {/if}
        </section>
      {/if}

    </div>
  </main>

  <!-- Tool Detail Modal -->
  <ToolDetailModal 
    tool={selectedTool}
    bind:isOpen={isToolModalOpen}
    on:close={closeToolDetail}
  />

  <!-- Footer CTA -->
  <section class="footer-cta">
    <div class="container">
      <div class="cta-content">
        <h3>{$t('framework.implementationTools.cta.title', 'Ready to Start Implementing?')}</h3>
        <p>{$t('framework.implementationTools.cta.description', 'Join our community of practitioners and start building better governance today.')}</p>
        <div class="cta-buttons">
          {#if !isAssessmentComplete}
            <button class="primary-button" on:click={() => selectSection('assessment')}>
              {$t('common.ui.takeAssessment', 'Take Assessment')}
            </button>
          {:else}
            <button class="primary-button" on:click={() => selectSection('tools')}>
              {$t('common.ui.exploreTools', 'Explore Tools')}
            </button>
          {/if}
          <a href="{base}/get-involved" class="secondary-button">
            {$t('common.ui.joinCommunity', 'Join Community')}
          </a>
        </div>
      </div>
    </div>
  </section>
</div>

<style>
  .implementation-tools-page {
    min-height: 100vh;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  /* Markdown Content Styling */
  .markdown-content {
    color: #374151;
    line-height: 1.7;
  }

  .markdown-content :global(h1) {
    font-size: 2rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 1rem;
    margin-top: 2rem;
  }

  .markdown-content :global(h2) {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1rem;
    margin-top: 1.5rem;
  }

  .markdown-content :global(h3) {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.75rem;
    margin-top: 1.25rem;
  }

  .markdown-content :global(h4) {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.5rem;
    margin-top: 1rem;
  }

  .markdown-content :global(p) {
    margin-bottom: 1rem;
    line-height: 1.7;
  }

  .markdown-content :global(ul), 
  .markdown-content :global(ol) {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }

  .markdown-content :global(li) {
    margin-bottom: 0.5rem;
    line-height: 1.6;
  }

  .markdown-content :global(blockquote) {
    border-left: 4px solid #3b82f6;
    padding-left: 1rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: #64748b;
  }

  .markdown-content :global(code) {
    background: #f1f5f9;
    color: #1e293b;
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
  }

  .markdown-content :global(pre) {
    background: #1e293b;
    color: #e2e8f0;
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1rem 0;
  }

  .markdown-content :global(pre code) {
    background: none;
    color: inherit;
    padding: 0;
  }

  /* Appendices Section */
  .appendices-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .appendix-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.75rem;
    padding: 1.5rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .appendix-card h3 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* Integration Section */
  .integration-section {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid #e2e8f0;
  }

  .integration-section h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .integration-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }

  .integration-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    padding: 1rem;
  }

  .integration-card h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.75rem;
  }

  /* Quickstart Section */
  .quickstart-section {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e2e8f0;
  }

  .quickstart-section h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .quickstart-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
  }

  .quickstart-card {
    background: #f0f9ff;
    border: 1px solid #bfdbfe;
    border-radius: 0.5rem;
    padding: 1rem;
  }

  .quickstart-card h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1e40af;
    margin-bottom: 0.75rem;
  }

  /* Header Styles */
  .page-header {
    background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
    color: white;
    padding: 3rem 0;
  }

  .header-content {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 3rem;
    align-items: center;
  }

  .page-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    line-height: 1.2;
  }

  .page-subtitle {
    font-size: 1.25rem;
    color: #cbd5e1;
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }

  .framework-meta {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .tier-badge, .status-badge {
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .tier-4 {
    background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
    color: white;
  }

  .status-review {
    background: linear-gradient(135deg, #f59e0b 0%, #eab308 100%);
    color: white;
  }

  .header-visual {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .toolkit-icon {
    font-size: 4rem;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  .connection-lines {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .line {
    position: absolute;
    background: linear-gradient(45deg, #60a5fa, #34d399);
    border-radius: 2px;
    animation: flow 3s infinite;
  }

  .line-1 {
    width: 3px;
    height: 30px;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    animation-delay: 0s;
  }

  .line-2 {
    width: 30px;
    height: 3px;
    right: -15px;
    top: 50%;
    transform: translateY(-50%);
    animation-delay: 1s;
  }

  .line-3 {
    width: 3px;
    height: 30px;
    bottom: -15px;
    left: 50%;
    transform: translateX(-50%);
    animation-delay: 2s;
  }

  @keyframes flow {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
  }

  /* Navigation Styles */
  .section-nav {
    background: white;
    border-bottom: 1px solid #e2e8f0;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .nav-tabs {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding: 1rem 0;
  }

  .nav-tab {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: none;
    border: none;
    border-radius: 0.5rem;
    color: #64748b;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .nav-tab:hover {
    background: #f1f5f9;
    color: #1e293b;
  }

  .nav-tab.active {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
  }

  .tab-icon {
    font-size: 1.25rem;
  }

  /* Content Styles */
  .main-content {
    padding: 2rem 0;
  }

  .content-section {
    margin-bottom: 3rem;
  }

  .section-header {
    text-align: center;
    margin-bottom: 2.5rem;
  }

  .section-header h2 {
    font-size: 2rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 1rem;
  }

  .section-header p {
    font-size: 1.125rem;
    color: #64748b;
    max-width: 600px;
    margin: 0 auto;
  }

  /* Overview Section */
  .section-grid {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 3rem;
    align-items: start;
  }

  .intro-text {
    font-size: 1.125rem;
    line-height: 1.7;
    color: #374151;
    margin-bottom: 2rem;
  }

  .key-features h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1.5rem;
  }

  .feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .feature-card {
    background: white;
    padding: 1.5rem;
    border-radius: 0.75rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
  }

  .feature-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
  }

  .feature-icon {
    font-size: 2rem;
    margin-bottom: 1rem;
  }

  .feature-card h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.75rem;
  }

  .feature-card p {
    color: #64748b;
    line-height: 1.6;
    margin: 0;
  }

  /* Quick Start */
  .quick-start h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1.5rem;
  }

  .step-flow {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .step-item {
    background: white;
    padding: 1.5rem;
    border-radius: 0.75rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    flex: 1;
    min-width: 200px;
    text-align: center;
  }

  .step-number {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    margin: 0 auto 1rem auto;
  }

  .step-content h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.5rem;
  }

  .step-content p {
    font-size: 0.875rem;
    color: #64748b;
    margin-bottom: 1rem;
    line-height: 1.5;
  }

  .step-action {
    background: #f8fafc;
    color: #3b82f6;
    border: 1px solid #e2e8f0;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .step-action:hover {
    background: #3b82f6;
    color: white;
  }

  .step-arrow {
    font-size: 1.5rem;
    color: #94a3b8;
    display: none;
  }

  /* Sidebar */
  .section-sidebar {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .info-card {
    background: white;
    padding: 1.5rem;
    border-radius: 0.75rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
  }

  .info-card h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.75rem;
  }

  .info-card p {
    font-size: 0.875rem;
    color: #64748b;
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .info-link {
    color: #3b82f6;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .info-link:hover {
    color: #1d4ed8;
  }

  /* Assessment Section */
  .assessment-results {
    background: white;
    padding: 2rem;
    border-radius: 0.75rem;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
  }

  .results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }

  .results-header h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1e293b;
  }

  .reset-button {
    background: #f8fafc;
    color: #64748b;
    border: 1px solid #e2e8f0;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .reset-button:hover {
    background: #e2e8f0;
  }

  .results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .result-item {
    text-align: center;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 0.5rem;
  }

  .result-item h4 {
    font-size: 0.875rem;
    font-weight: 500;
    color: #64748b;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .result-value {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1e293b;
    text-transform: capitalize;
  }

  .recommendation {
    border-top: 1px solid #e2e8f0;
    padding-top: 2rem;
  }

  .recommendation h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1rem;
  }

  .recommended-stack {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    padding: 1.5rem;
    border-radius: 0.75rem;
    border: 1px solid #0ea5e9;
  }

  .stack-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }

  .stack-header h5 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #0c4a6e;
    margin: 0;
  }

  .complexity-badge {
    background: #0ea5e9;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 500;
  }

  .recommended-stack p {
    color: #0c4a6e;
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .stack-meta {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .meta-item {
    font-size: 0.875rem;
    color: #0369a1;
    font-weight: 500;
  }

  .view-stack-button {
    background: #0ea5e9;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .view-stack-button:hover {
    background: #0284c7;
    transform: translateY(-1px);
  }

  /* Guidance Section */
  .guidance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .guidance-card {
    background: white;
    padding: 2rem;
    border-radius: 0.75rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
  }

  .guidance-card h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1.5rem;
  }

  .guidance-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .guidance-card li {
    padding: 0.5rem 0;
    color: #374151;
    border-bottom: 1px solid #f1f5f9;
    position: relative;
    padding-left: 1.5rem;
  }

  .guidance-card li:before {
    content: "‚Ä¢";
    color: #3b82f6;
    font-weight: bold;
    position: absolute;
    left: 0;
  }

  .phase-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .phase-item {
    padding: 1rem;
    background: #f8fafc;
    border-radius: 0.5rem;
    border-left: 4px solid #3b82f6;
  }

  .phase-item h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.5rem;
  }

  .phase-item p {
    font-size: 0.875rem;
    color: #64748b;
    margin: 0;
    line-height: 1.5;
  }

  /* Footer CTA */
  .footer-cta {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    color: white;
    padding: 3rem 0;
    margin-top: 3rem;
  }

  .cta-content {
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }

  .cta-content h3 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }

  .cta-content p {
    font-size: 1.125rem;
    color: #cbd5e1;
    margin-bottom: 2rem;
    line-height: 1.6;
  }

  .cta-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }

  .primary-button, .secondary-button {
    padding: 0.75rem 2rem;
    border-radius: 0.5rem;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    font-size: 1rem;
  }

  .primary-button {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
  }

  .primary-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }

  .secondary-button {
    background: transparent;
    color: white;
    border: 2px solid #60a5fa;
  }

  .secondary-button:hover {
    background: #60a5fa;
    color: #1e293b;
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .section-grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .header-content {
      grid-template-columns: 1fr;
      text-align: center;
    }

    .step-arrow {
      display: block;
    }

    .step-flow {
      flex-direction: column;
      align-items: center;
    }

    .appendices-grid {
      grid-template-columns: 1fr;
    }

    .integration-grid {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .page-title {
      font-size: 2rem;
    }

    .page-subtitle {
      font-size: 1rem;
    }

    .nav-tabs {
      padding: 0.5rem 0;
    }

    .nav-tab {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    .tab-text {
      display: none;
    }

    .feature-grid {
      grid-template-columns: 1fr;
    }

    .results-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .guidance-grid {
      grid-template-columns: 1fr;
    }

    .cta-content h3 {
      font-size: 1.5rem;
    }

    .cta-buttons {
      flex-direction: column;
      align-items: center;
    }

    .primary-button, .secondary-button {
      width: 100%;
      max-width: 300px;
    }

    .integration-grid {
      grid-template-columns: 1fr;
    }

    .quickstart-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .container {
      padding: 0 0.75rem;
    }

    .results-grid {
      grid-template-columns: 1fr;
    }

    .stack-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .stack-meta {
      flex-direction: column;
      gap: 0.5rem;
    }

    .appendix-card {
      padding: 1rem;
    }

    .integration-card, .quickstart-card {
      padding: 0.75rem;
    }
  }

  /* Print styles */
  @media print {
    .page-header,
    .section-nav,
    .footer-cta {
      display: none;
    }
    
    .appendix-card, .integration-card, .quickstart-card {
      break-inside: avoid;
      box-shadow: none;
      border: 1px solid #ccc;
    }
  }
</style>
